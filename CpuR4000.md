# CPU - [R4000](https://code.google.com/p/jpcsp/source/detail?r=4000) The psp processor #

[R4000](https://code.google.com/p/jpcsp/source/detail?r=4000) is a RISC MIPS processor, has 32 registers of general purpose ([R0](https://code.google.com/p/jpcsp/source/detail?r=0) to [R31](https://code.google.com/p/jpcsp/source/detail?r=31))
and 3 for special purpose (PC, HI and LO).
The clock is clocked from 1 to 333MHz, the processor counts with helpers CoProcessors.

## Registers ##
  1. 32 general purpose (**[r0](https://code.google.com/p/jpcsp/source/detail?r=0) to [r31](https://code.google.com/p/jpcsp/source/detail?r=31)**)
  1. **PC** a program counter register
  1. **HI** holds the higher results from divide or multiply operation
  1. **LO** holds the lower results from divide or multiply operation


---

_At Multiply operation_

The product of integer multiply operation. (**HI** and **LO**)

_At Divide operation_

The quotient is stored on **LO** and the remainder is stored on **HI**.

---

**from 32 general purpose:**

|**[r0](https://code.google.com/p/jpcsp/source/detail?r=0)** = hardwired to value of zero, can be used as source when zero value is needed.|
|:-----------------------------------------------------------------------------------------------------------------------------------------|
|**[r1](https://code.google.com/p/jpcsp/source/detail?r=1)** = assembler temp|
|**[r2](https://code.google.com/p/jpcsp/source/detail?r=2)** = return value|
|**[r3](https://code.google.com/p/jpcsp/source/detail?r=3)** = return value|
|**[r4](https://code.google.com/p/jpcsp/source/detail?r=4)** = argument registers|
|**[r5](https://code.google.com/p/jpcsp/source/detail?r=5)** = argument registers|
|**[r6](https://code.google.com/p/jpcsp/source/detail?r=6)** = argument registers|
|**[r7](https://code.google.com/p/jpcsp/source/detail?r=7)** = argument registers|
|**[r8](https://code.google.com/p/jpcsp/source/detail?r=8)** = caller saved (o32 old style names: default)|
|**[r9](https://code.google.com/p/jpcsp/source/detail?r=9)** = 	t1 	 |
|**[r10](https://code.google.com/p/jpcsp/source/detail?r=10)** =	t2 	 |
|**[r11](https://code.google.com/p/jpcsp/source/detail?r=11)** =	t3 	 |
|**[r12](https://code.google.com/p/jpcsp/source/detail?r=12)** =	t4 	caller saved|
|**[r13](https://code.google.com/p/jpcsp/source/detail?r=13)** =	t5 	 |
|**[r14](https://code.google.com/p/jpcsp/source/detail?r=14)** =	t6 	 |
|**[r15](https://code.google.com/p/jpcsp/source/detail?r=15)** =	t7 	 |
|**[r16](https://code.google.com/p/jpcsp/source/detail?r=16)** =	s0 	callee saved|
|**[r17](https://code.google.com/p/jpcsp/source/detail?r=17)** =	s1 	 |
|**[r18](https://code.google.com/p/jpcsp/source/detail?r=18)** =	s2 	 |
|**[r19](https://code.google.com/p/jpcsp/source/detail?r=19)** =	s3 	 |
|**[r20](https://code.google.com/p/jpcsp/source/detail?r=20)** =	s4 	 |
|**[r21](https://code.google.com/p/jpcsp/source/detail?r=21)** =	s5 	 |
|**[r22](https://code.google.com/p/jpcsp/source/detail?r=22)** =	s6 	 |
|**[r23](https://code.google.com/p/jpcsp/source/detail?r=23)** =	s7 	 |
|**[r24](https://code.google.com/p/jpcsp/source/detail?r=24)** = caller saved|
|**[r25](https://code.google.com/p/jpcsp/source/detail?r=25)** = caller saved|
|**[r26](https://code.google.com/p/jpcsp/source/detail?r=26)** = kernel temporary k0|
|**[r27](https://code.google.com/p/jpcsp/source/detail?r=27)** = kernel temporary k0|
|**[r28](https://code.google.com/p/jpcsp/source/detail?r=28)** = global pointer|
|**[r29](https://code.google.com/p/jpcsp/source/detail?r=29)** = stack pointer|
|**[r30](https://code.google.com/p/jpcsp/source/detail?r=30)** = frame pointer|
|**[r31](https://code.google.com/p/jpcsp/source/detail?r=31)** = is used as link by Jump and Link instructions. (it should not be used by others instructions)|

ps: Almost all processor has the status regiter(s), but that one uses the coprocessor (**CP0**) to control stuffs.

## Instructions ##

Each instruction (opcode+...) is a single 4Bytes (32bits) word.
ex:
|31|30| |29| |28| |27| |26| |25| |24| |23| |22| |21| |20| |19| |18| |17| |16| |15| |14| |13| |12| |11| |10| |09| |08| |07| |06| |05| |04| |03| |02| |01| |00| |
|:-|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|

The opcode is 6 bites. |31|30| |29| |28| |27| |26| |
|:-|:-|:|:-|:|:-|:|:-|:|:-|:|

### Types of instructions ###

There is a three types of instructions format: (AKA addressing modes)
  1. Immediate (imm)
  1. Jump (j)
  1. Register (r)

**When is Immediate** (imm) Format: **opcode** + **register [rs ](.md)** + **register [rt ](.md)** + **immediate**

|31|30| |29| |28| |27| |26| |25| |24| |23| |22| |21| |20| |19| |18| |17| |16| |15| |14| |13| |12| |11| |10| |09| |08| |07| |06| |05| |04| |03| |02| |01| |00| |
|:-|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|

**opcode** = between 31 - 26 (include)

**rs** = between 25 - 21 (include)

**rt** = between 20 - 16 (include)

**immediate** = between 15 - 0 (include)


  1. opcode = instruction number 	        (6bites)
  1. rs = register source 		(5bites) (one of 32 general propurse)
  1. rt = register target 		(5bites) (one of 32 general propurse)
  1. imm = immediate value 		(16bites)

ex:
ADDI [R2](https://code.google.com/p/jpcsp/source/detail?r=2),[R5](https://code.google.com/p/jpcsp/source/detail?r=5),0x11; (see and show a sample)


**When is Jump** (j) Format: **opcode** + **target**

|31|30| |29| |28| |27| |26| |25| |24| |23| |22| |21| |20| |19| |18| |17| |16| |15| |14| |13| |12| |11| |10| |09| |08| |07| |06| |05| |04| |03| |02| |01| |00| |
|:-|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|

**opcode** = between 31 - 26 (include)

**target** = between 25 - 0 (include)

  1. opcode = instruction number 	(6bites)
  1. target = address to jump	(26bites)

ex: (see and show a sample)

**When is Register** (r)  Format: **opcode** + **register [rs ](.md)** + **register [rt ](.md)** + **register [rd ](.md)** + **sa** + **funct**

|31|30| |29| |28| |27| |26| |25| |24| |23| |22| |21| |20| |19| |18| |17| |16| |15| |14| |13| |12| |11| |10| |09| |08| |07| |06| |05| |04| |03| |02| |01| |00| |
|:-|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|:-|:|

**opcode** = between 31 - 26 (include)

**rs** = between 25 - 21 (include)

**rt** = between 20 - 16 (include)

**rd** = between 15 - 11 (include)

**sa** = between 10 - 6 (include)

**funct** = between 5 - 0 (include)

  1. opcode = instruction number 	(6bites)
  1. rs = register source 		(5bites) (one of 32 general propurse)
  1. rt = register target 		(5bites) (one of 32 general propurse)
  1. rd = register destination	(5bites) (one of 32 general propurse)
  1. sa = shift amount 		(5bites)
  1. funct = function filed 		(6bites)

ex: (see and shows a sample)

  * All Load and Store instructions uses the immediate way. (same for coprocessor)
  * Instructions that peforms: arithmetic, logical, shift, multiply and divide uses register and immediate way.
  * Special instructions performs system calls and breakpoint and these are always regiter way.
  * Excpetions instructions occurs in both way immediate and register.